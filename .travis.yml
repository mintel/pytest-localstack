language: python
services:
  - docker

python:
  - 2.7
  - 3.4
  - 3.5
  - 3.6
  - 3.7-dev

matrix:
  fast_finish: true
  allow_failures:
    - python: 3.7-dev

stages:
  - lint
  - test
  - docs

before_install:
  - pip install --upgrade pip setuptools
  - pip install --upgrade codecov pytest-cov

install:
  - pip install --upgrade -e '.[test]'

script: pytest -ra --cov=pytest_localstack/

after_success: codecov

jobs:
  include:
    - stage: lint
      python: 3.6
      services: []
      install:
        - pip install --upgrade pip setuptools
        - pip install --upgrade pipenv docutils flake8 flake8-debugger flake8-docstrings flake8-isort Pygments
      script:
        - pipenv check
        - flake8
        - flake8 --config tests/.flake8 tests/
        - python setup.py check --restructuredtext --strict
      after_success: skip
    - stage: docs
      python: 3.6
      install:
        - pip install --upgrade pip setuptools
        - pip install --upgrade Sphinx recommonmark
      script:
        - cd docs && make html
      after_success: skip
